<?xml version="1.0" encoding="utf-8"?>
<!--
  Code Coverage Configuration
  Based on: docs/testing-strategy.md
  
  This file configures what code is included/excluded from coverage reports.
  Reference: docs/testing-strategy.md for detailed explanation of what should be tested.
-->
<RunSettings>
  <DataCollectionRunSettings>
    <DataCollectors>
      <DataCollector friendlyName="XPlat code coverage">
        <Configuration>
          <Format>cobertura</Format>
          
          <!--
            WHAT IS INCLUDED IN COVERAGE:
            ✅ Business Logic (Business Services, Repositories)
            ✅ Public API Contracts (Controllers, Service interfaces, Repository methods)
            ✅ Error Handling (Exception scenarios, null handling)
            ✅ Data Access Logic (Query filters, complex queries, transactions)
            ✅ Integration Points (External services, cache, middleware, filters)
            
            Only code in ../src directory is included (test projects excluded automatically).
          -->
          
          <!--
            EXCLUDE: Test Projects
            Per testing-strategy.md: Test projects should not be included in coverage metrics.
          -->
          <Exclude>[*.Tests]*,[*.Test]*</Exclude>
          
          <!--
            EXCLUDE: Generated Code and Obsolete Code
            Per testing-strategy.md Section "3. Generated Code":
            - Database migrations (generated by EF Core)
            - Compiler-generated code
            - Code with [GeneratedCode] attribute
            - Obsolete code
          -->
          <ExcludeByAttribute>Obsolete,GeneratedCodeAttribute,CompilerGeneratedAttribute</ExcludeByAttribute>
          
          <!--
            EXCLUDE: Files and Directories
            Per testing-strategy.md:

            1. Generated Code (Section "3. Generated Code")
               - **/DbUpMigration/** - Database migration scripts
               - **/Migrations/** - EF Core migrations

            2. Configuration and Startup Code (Section "6. Configuration and Startup Code")
               - **/Program.cs - Application startup code
               - **/DependencyInjection.cs - Dependency injection setup
               - **/Startup.cs - Application startup code

            3. Simple Property Accessors (Section "2. Simple Property Accessors")
               - **/*Dto.cs - DTOs with only properties (trivial code)
               - **/WebShop.Api/Models/** - API models (simple property accessors)
               - **/WebShop.Business/DTOs/** - Business DTOs (simple property accessors)

            4. Framework Extensions and Helpers (Section "1. Framework Code")
               - **/Extensions/Core/** - Framework extension methods
               - **/Helpers/OpenApiTransformer.cs - Framework helpers

            Note: Framework code (ASP.NET Core, EF Core internals) cannot be easily excluded
            via file patterns but is documented as excluded per testing-strategy.md Section "1. Framework Code".
          -->
          <ExcludeByFile>**/DbUpMigration/**,**/Migrations/**,**/Program.cs,**/DependencyInjection.cs,**/Startup.cs,**/*Dto.cs,**/WebShop.Api/Models/**,**/WebShop.Business/DTOs/**,**/Extensions/Core/**,**/Helpers/OpenApiTransformer.cs</ExcludeByFile>
          
          <!--
            INCLUDE: Only Source Code Directory
            Per testing-strategy.md Section "Code Coverage Configuration":
            Only include code from the ../src directory (excludes test projects automatically).
          -->
          <IncludeDirectory>../src</IncludeDirectory>
        </Configuration>
      </DataCollector>
    </DataCollectors>
  </DataCollectionRunSettings>
</RunSettings>
